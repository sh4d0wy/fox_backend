import{An as e,Cn as t,Dn as n,En as r,Gn as i,Mn as a,Nn as o,On as s,Tn as c,jn as l,kn as u}from"./index-C4v0axf5.js";import{t as d}from"./v4-CbYvpsTg.js";var f=i(t());l(),o();function p(e){return e.version===void 0}function m(e){return p(e)?e.serialize({verifySignatures:!1,requireAllSignatures:!1}):e.serialize()}var h=function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||=Promise)(function(n,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){e.done?n(e.value):i(e.value).then(o,s)}c((r=r.apply(e,t||[])).next())})};function g(e){return h(this,void 0,void 0,function*(){try{return yield e.request({method:`wallet_getSnaps`}),!0}catch{return!1}})}function _(){return h(this,void 0,void 0,function*(){try{let e=window.ethereum;if(!e)return null;if(e.providers&&Array.isArray(e.providers)){let t=e.providers;for(let e of t)if(yield g(e))return e}if(e.detected&&Array.isArray(e.detected)){let t=e.detected;for(let e of t)if(yield g(e))return e}return(yield g(e))?e:null}catch(e){return console.error(e),null}})}const v=[`solana:mainnet`,`solana:devnet`,`solana:testnet`,`solana:localnet`];function y(e){return v.includes(e)}var b=function(e,t,n,r){if(n===`a`&&!r)throw TypeError(`Private accessor was defined without a getter`);if(typeof t==`function`?e!==t||!r:!t.has(e))throw TypeError(`Cannot read private member from an object whose class did not declare it`);return n===`m`?r:n===`a`?r.call(e):r?r.value:t.get(e)},x=function(e,t,n,r,i){if(r===`m`)throw TypeError(`Private method is not writable`);if(r===`a`&&!i)throw TypeError(`Private accessor was defined without a setter`);if(typeof t==`function`?e!==t||!i:!t.has(e))throw TypeError(`Cannot write private member to an object whose class did not declare it`);return r===`a`?i.call(e,n):i?i.value=n:t.set(e,n),n},S,C,w,T,E,D,O=v,k=[n,c,r],A=class e{get address(){return b(this,S,`f`)}get publicKey(){return b(this,C,`f`).slice()}get chains(){return b(this,w,`f`).slice()}get features(){return b(this,T,`f`).slice()}get label(){return b(this,E,`f`)}get icon(){return b(this,D,`f`)}constructor({address:t,publicKey:n,label:r,icon:i}){S.set(this,void 0),C.set(this,void 0),w.set(this,void 0),T.set(this,void 0),E.set(this,void 0),D.set(this,void 0),new.target===e&&Object.freeze(this),x(this,S,t,`f`),x(this,C,n,`f`),x(this,w,O,`f`),x(this,T,k,`f`),x(this,E,r,`f`),x(this,D,i,`f`)}};S=new WeakMap,C=new WeakMap,w=new WeakMap,T=new WeakMap,E=new WeakMap,D=new WeakMap;var j=function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||=Promise)(function(n,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){e.done?n(e.value):i(e.value).then(o,s)}c((r=r.apply(e,t||[])).next())})},M=class t extends a{constructor(e){super(),this._network=`mainnet-beta`,this._iframeParams={},this._element=null,this._iframe=null,this._publicKey=null,this._account=null,this._isConnected=!1,this._connectHandler=null,this._messageHandlers={},this._handleEvent=e=>{switch(e.type){case`connect`:this._collapseIframe(),e.data?.publicKey?(this._publicKey=e.data.publicKey,this._isConnected=!0,this._connectHandler&&=(this._connectHandler.resolve(),null),this._connected()):(this._connectHandler&&=(this._connectHandler.reject(),null),this._disconnected());return;case`disconnect`:this._connectHandler&&=(this._connectHandler.reject(),null),this._disconnected();return;case`accountChanged`:e.data?.publicKey?(this._publicKey=e.data.publicKey,this.emit(`accountChanged`,this.publicKey),this._standardConnected()):(this.emit(`accountChanged`,void 0),this._standardDisconnected());return;default:return}},this._handleResize=e=>{e.resizeMode===`full`?e.params.mode===`fullscreen`?this._expandIframe():e.params.mode===`hide`&&this._collapseIframe():e.resizeMode===`coordinates`&&this._resizeIframe(e.params)},this._handleMessage=e=>{if(e.data?.channel!==`solflareIframeToWalletAdapter`)return;let t=e.data.data||{};if(t.type===`event`)this._handleEvent(t.event);else if(t.type===`resize`)this._handleResize(t);else if(t.type===`response`&&this._messageHandlers[t.id]){let{resolve:e,reject:n}=this._messageHandlers[t.id];delete this._messageHandlers[t.id],t.error?n(t.error):e(t.result)}},this._removeElement=()=>{this._element&&=(this._element.remove(),null)},this._removeDanglingElements=()=>{let e=document.getElementsByClassName(`solflare-metamask-wallet-adapter-iframe`);for(let t of e)t.parentElement&&t.remove()},this._injectElement=()=>{this._removeElement(),this._removeDanglingElements();let e=Object.assign(Object.assign({},this._iframeParams),{mm:!0,v:1,cluster:this._network||`mainnet-beta`,origin:window.location.origin||``,title:document.title||``}),n=Object.keys(e).map(t=>`${t}=${encodeURIComponent(e[t])}`).join(`&`),r=`${t.IFRAME_URL}?${n}`;this._element=document.createElement(`div`),this._element.className=`solflare-metamask-wallet-adapter-iframe`,this._element.innerHTML=`
      <iframe src='${r}' style='position: fixed; top: 0; bottom: 0; left: 0; right: 0; width: 100%; height: 100%; border: none; border-radius: 0; z-index: 99999; color-scheme: auto;' allowtransparency='true'></iframe>
    `,document.body.appendChild(this._element),this._iframe=this._element.querySelector(`iframe`),window.addEventListener(`message`,this._handleMessage,!1)},this._collapseIframe=()=>{this._iframe&&(this._iframe.style.top=``,this._iframe.style.right=``,this._iframe.style.height=`2px`,this._iframe.style.width=`2px`)},this._expandIframe=()=>{this._iframe&&(this._iframe.style.top=`0px`,this._iframe.style.bottom=`0px`,this._iframe.style.left=`0px`,this._iframe.style.right=`0px`,this._iframe.style.width=`100%`,this._iframe.style.height=`100%`)},this._resizeIframe=e=>{this._iframe&&(this._iframe.style.top=isFinite(e.top)?`${e.top}px`:``,this._iframe.style.bottom=isFinite(e.bottom)?`${e.bottom}px`:``,this._iframe.style.left=isFinite(e.left)?`${e.left}px`:``,this._iframe.style.right=isFinite(e.right)?`${e.right}px`:``,this._iframe.style.width=isFinite(e.width)?`${e.width}px`:e.width,this._iframe.style.height=isFinite(e.height)?`${e.height}px`:e.height)},this._sendIframeMessage=e=>{if(!this.connected||!this.publicKey)throw Error(`Wallet not connected`);return new Promise((t,n)=>{var r;let i=d();this._messageHandlers[i]={resolve:t,reject:n},(r=this._iframe?.contentWindow)==null||r.postMessage({channel:`solflareWalletAdapterToIframe`,data:Object.assign({id:i},e)},`*`)})},this._connected=()=>{this._isConnected=!0,this.emit(`connect`,this.publicKey),this._standardConnected()},this._disconnected=()=>{this._publicKey=null,this._isConnected=!1,window.removeEventListener(`message`,this._handleMessage,!1),this._removeElement(),this.emit(`disconnect`),this._standardDisconnected()},this._standardConnected=()=>{if(!this.publicKey)return;let e=this.publicKey.toString();(!this._account||this._account.address!==e)&&(this._account=new A({address:e,publicKey:this.publicKey.toBytes()}),this.emit(`standard_change`,{accounts:this.standardAccounts}))},this._standardDisconnected=()=>{this._account&&(this._account=null,this.emit(`standard_change`,{accounts:this.standardAccounts}))},e?.network&&(this._network=e?.network),window.SolflareMetaMaskParams&&(this._iframeParams=Object.assign(Object.assign({},this._iframeParams),window.SolflareMetaMaskParams)),e?.params&&(this._iframeParams=Object.assign(Object.assign({},this._iframeParams),e?.params))}get publicKey(){return this._publicKey?new s(this._publicKey):null}get standardAccount(){return this._account}get standardAccounts(){return this._account?[this._account]:[]}get isConnected(){return this._isConnected}get connected(){return this.isConnected}get autoApprove(){return!1}connect(){return j(this,void 0,void 0,function*(){this.connected||(this._injectElement(),yield new Promise((e,t)=>{this._connectHandler={resolve:e,reject:t}}))})}disconnect(){return j(this,void 0,void 0,function*(){yield this._sendIframeMessage({method:`disconnect`}),this._disconnected()})}signTransaction(t){return j(this,void 0,void 0,function*(){if(!this.connected||!this.publicKey)throw Error(`Wallet not connected`);try{let n=m(t),{transaction:r}=yield this._sendIframeMessage({method:`signTransactionV2`,params:{transaction:f.default.encode(n)}});return p(t)?u.from(f.default.decode(r)):e.deserialize(f.default.decode(r))}catch(e){throw Error((e?.toString)?.call(e)||`Failed to sign transaction`)}})}signAllTransactions(t){return j(this,void 0,void 0,function*(){if(!this.connected||!this.publicKey)throw Error(`Wallet not connected`);try{let n=t.map(e=>m(e)),{transactions:r}=yield this._sendIframeMessage({method:`signAllTransactionsV2`,params:{transactions:n.map(e=>f.default.encode(e))}});return r.map((n,r)=>p(t[r])?u.from(f.default.decode(n)):e.deserialize(f.default.decode(n)))}catch(e){throw Error((e?.toString)?.call(e)||`Failed to sign transactions`)}})}signAndSendTransaction(e,t){return j(this,void 0,void 0,function*(){if(!this.connected||!this.publicKey)throw Error(`Wallet not connected`);try{let n=m(e),{signature:r}=yield this._sendIframeMessage({method:`signAndSendTransaction`,params:{transaction:f.default.encode(n),options:t}});return r}catch(e){throw Error((e?.toString)?.call(e)||`Failed to sign and send transaction`)}})}signMessage(e,t=`utf8`){return j(this,void 0,void 0,function*(){if(!this.connected||!this.publicKey)throw Error(`Wallet not connected`);try{let{signature:n}=yield this._sendIframeMessage({method:`signMessage`,params:{data:f.default.encode(e),display:t}});return Uint8Array.from(f.default.decode(n))}catch(e){throw Error((e?.toString)?.call(e)||`Failed to sign message`)}})}sign(e,t=`utf8`){return j(this,void 0,void 0,function*(){return yield this.signMessage(e,t)})}static isSupported(){return j(this,void 0,void 0,function*(){return!!(yield _())})}standardSignAndSendTransaction(...t){return j(this,void 0,void 0,function*(){if(!this.connected)throw Error(`not connected`);let n=[];if(t.length===1){let{transaction:r,account:i,chain:a,options:o}=t[0],{minContextSlot:s,preflightCommitment:c,skipPreflight:l,maxRetries:u}=o||{};if(i!==this._account)throw Error(`invalid account`);if(!y(a))throw Error(`invalid chain`);let d=yield this.signAndSendTransaction(e.deserialize(r),{preflightCommitment:c,minContextSlot:s,maxRetries:u,skipPreflight:l});n.push({signature:f.default.decode(d)})}else if(t.length>1)for(let e of t)n.push(...yield this.standardSignAndSendTransaction(e));return n})}standardSignTransaction(...t){return j(this,void 0,void 0,function*(){if(!this.connected)throw Error(`not connected`);let n=[];if(t.length===1){let{transaction:r,account:i,chain:a}=t[0];if(i!==this._account)throw Error(`invalid account`);if(a&&!y(a))throw Error(`invalid chain`);let o=yield this.signTransaction(e.deserialize(r));n.push({signedTransaction:o.serialize()})}else if(t.length>1){let r;for(let e of t){if(e.account!==this._account)throw Error(`invalid account`);if(e.chain){if(!y(e.chain))throw Error(`invalid chain`);if(r){if(e.chain!==r)throw Error(`conflicting chain`)}else r=e.chain}}let i=t.map(({transaction:t})=>e.deserialize(t)),a=yield this.signAllTransactions(i);n.push(...a.map(e=>({signedTransaction:e.serialize()})))}return n})}standardSignMessage(...e){return j(this,void 0,void 0,function*(){if(!this.connected)throw Error(`not connected`);let t=[];if(e.length===1){let{message:n,account:r}=e[0];if(r!==this._account)throw Error(`invalid account`);let i=yield this.signMessage(n);t.push({signedMessage:n,signature:i})}else if(e.length>1)for(let n of e)t.push(...yield this.standardSignMessage(n));return t})}};M.IFRAME_URL=`https://widget.solflare.com/`;var N=M;export{A as StandardSolflareMetaMaskWalletAccount,N as default};