import{An as e,Dn as t,Fn as n,In as r,Ln as i,Mn as a,Nn as o,Pn as s,Yn as c,jn as l,kn as u}from"./index-DFRddyEP.js";import{t as d}from"./v4-CbYvpsTg.js";var f=c(t());n(),i();function p(e){return e.version===void 0}function m(e){return p(e)?e.serialize({verifySignatures:!1,requireAllSignatures:!1}):e.serialize()}var h=function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||=Promise)(function(n,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){e.done?n(e.value):i(e.value).then(o,s)}c((r=r.apply(e,t||[])).next())})};function g(e){return h(this,void 0,void 0,function*(){try{return yield e.request({method:`wallet_getSnaps`}),!0}catch{return!1}})}function _(){return h(this,void 0,void 0,function*(){try{let e=window.ethereum;if(!e)return null;if(e.providers&&Array.isArray(e.providers)){let t=e.providers;for(let e of t)if(yield g(e))return e}if(e.detected&&Array.isArray(e.detected)){let t=e.detected;for(let e of t)if(yield g(e))return e}return(yield g(e))?e:null}catch(e){return console.error(e),null}})}const v=[`solana:mainnet`,`solana:devnet`,`solana:testnet`,`solana:localnet`];function y(e){return v.includes(e)}var b=function(e,t,n,r){if(n===`a`&&!r)throw TypeError(`Private accessor was defined without a getter`);if(typeof t==`function`?e!==t||!r:!t.has(e))throw TypeError(`Cannot read private member from an object whose class did not declare it`);return n===`m`?r:n===`a`?r.call(e):r?r.value:t.get(e)},x=function(e,t,n,r,i){if(r===`m`)throw TypeError(`Private method is not writable`);if(r===`a`&&!i)throw TypeError(`Private accessor was defined without a setter`);if(typeof t==`function`?e!==t||!i:!t.has(e))throw TypeError(`Cannot write private member to an object whose class did not declare it`);return r===`a`?i.call(e,n):i?i.value=n:t.set(e,n),n},S,C,w,T,E,D,O=v,k=[l,u,e],A=class e{get address(){return b(this,S,`f`)}get publicKey(){return b(this,C,`f`).slice()}get chains(){return b(this,w,`f`).slice()}get features(){return b(this,T,`f`).slice()}get label(){return b(this,E,`f`)}get icon(){return b(this,D,`f`)}constructor({address:t,publicKey:n,label:r,icon:i}){S.set(this,void 0),C.set(this,void 0),w.set(this,void 0),T.set(this,void 0),E.set(this,void 0),D.set(this,void 0),new.target===e&&Object.freeze(this),x(this,S,t,`f`),x(this,C,n,`f`),x(this,w,O,`f`),x(this,T,k,`f`),x(this,E,r,`f`),x(this,D,i,`f`)}};S=new WeakMap,C=new WeakMap,w=new WeakMap,T=new WeakMap,E=new WeakMap,D=new WeakMap;var j=function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||=Promise)(function(n,a){function o(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){e.done?n(e.value):i(e.value).then(o,s)}c((r=r.apply(e,t||[])).next())})},M=class e extends r{constructor(t){super(),this._network=`mainnet-beta`,this._iframeParams={},this._element=null,this._iframe=null,this._publicKey=null,this._account=null,this._isConnected=!1,this._connectHandler=null,this._messageHandlers={},this._handleEvent=e=>{switch(e.type){case`connect`:this._collapseIframe(),e.data?.publicKey?(this._publicKey=e.data.publicKey,this._isConnected=!0,this._connectHandler&&=(this._connectHandler.resolve(),null),this._connected()):(this._connectHandler&&=(this._connectHandler.reject(),null),this._disconnected());return;case`disconnect`:this._connectHandler&&=(this._connectHandler.reject(),null),this._disconnected();return;case`accountChanged`:e.data?.publicKey?(this._publicKey=e.data.publicKey,this.emit(`accountChanged`,this.publicKey),this._standardConnected()):(this.emit(`accountChanged`,void 0),this._standardDisconnected());return;default:return}},this._handleResize=e=>{e.resizeMode===`full`?e.params.mode===`fullscreen`?this._expandIframe():e.params.mode===`hide`&&this._collapseIframe():e.resizeMode===`coordinates`&&this._resizeIframe(e.params)},this._handleMessage=e=>{if(e.data?.channel!==`solflareIframeToWalletAdapter`)return;let t=e.data.data||{};if(t.type===`event`)this._handleEvent(t.event);else if(t.type===`resize`)this._handleResize(t);else if(t.type===`response`&&this._messageHandlers[t.id]){let{resolve:e,reject:n}=this._messageHandlers[t.id];delete this._messageHandlers[t.id],t.error?n(t.error):e(t.result)}},this._removeElement=()=>{this._element&&=(this._element.remove(),null)},this._removeDanglingElements=()=>{let e=document.getElementsByClassName(`solflare-metamask-wallet-adapter-iframe`);for(let t of e)t.parentElement&&t.remove()},this._injectElement=()=>{this._removeElement(),this._removeDanglingElements();let t=Object.assign(Object.assign({},this._iframeParams),{mm:!0,v:1,cluster:this._network||`mainnet-beta`,origin:window.location.origin||``,title:document.title||``}),n=Object.keys(t).map(e=>`${e}=${encodeURIComponent(t[e])}`).join(`&`),r=`${e.IFRAME_URL}?${n}`;this._element=document.createElement(`div`),this._element.className=`solflare-metamask-wallet-adapter-iframe`,this._element.innerHTML=`
      <iframe src='${r}' style='position: fixed; top: 0; bottom: 0; left: 0; right: 0; width: 100%; height: 100%; border: none; border-radius: 0; z-index: 99999; color-scheme: auto;' allowtransparency='true'></iframe>
    `,document.body.appendChild(this._element),this._iframe=this._element.querySelector(`iframe`),window.addEventListener(`message`,this._handleMessage,!1)},this._collapseIframe=()=>{this._iframe&&(this._iframe.style.top=``,this._iframe.style.right=``,this._iframe.style.height=`2px`,this._iframe.style.width=`2px`)},this._expandIframe=()=>{this._iframe&&(this._iframe.style.top=`0px`,this._iframe.style.bottom=`0px`,this._iframe.style.left=`0px`,this._iframe.style.right=`0px`,this._iframe.style.width=`100%`,this._iframe.style.height=`100%`)},this._resizeIframe=e=>{this._iframe&&(this._iframe.style.top=isFinite(e.top)?`${e.top}px`:``,this._iframe.style.bottom=isFinite(e.bottom)?`${e.bottom}px`:``,this._iframe.style.left=isFinite(e.left)?`${e.left}px`:``,this._iframe.style.right=isFinite(e.right)?`${e.right}px`:``,this._iframe.style.width=isFinite(e.width)?`${e.width}px`:e.width,this._iframe.style.height=isFinite(e.height)?`${e.height}px`:e.height)},this._sendIframeMessage=e=>{if(!this.connected||!this.publicKey)throw Error(`Wallet not connected`);return new Promise((t,n)=>{var r;let i=d();this._messageHandlers[i]={resolve:t,reject:n},(r=this._iframe?.contentWindow)==null||r.postMessage({channel:`solflareWalletAdapterToIframe`,data:Object.assign({id:i},e)},`*`)})},this._connected=()=>{this._isConnected=!0,this.emit(`connect`,this.publicKey),this._standardConnected()},this._disconnected=()=>{this._publicKey=null,this._isConnected=!1,window.removeEventListener(`message`,this._handleMessage,!1),this._removeElement(),this.emit(`disconnect`),this._standardDisconnected()},this._standardConnected=()=>{if(!this.publicKey)return;let e=this.publicKey.toString();(!this._account||this._account.address!==e)&&(this._account=new A({address:e,publicKey:this.publicKey.toBytes()}),this.emit(`standard_change`,{accounts:this.standardAccounts}))},this._standardDisconnected=()=>{this._account&&(this._account=null,this.emit(`standard_change`,{accounts:this.standardAccounts}))},t?.network&&(this._network=t?.network),window.SolflareMetaMaskParams&&(this._iframeParams=Object.assign(Object.assign({},this._iframeParams),window.SolflareMetaMaskParams)),t?.params&&(this._iframeParams=Object.assign(Object.assign({},this._iframeParams),t?.params))}get publicKey(){return this._publicKey?new a(this._publicKey):null}get standardAccount(){return this._account}get standardAccounts(){return this._account?[this._account]:[]}get isConnected(){return this._isConnected}get connected(){return this.isConnected}get autoApprove(){return!1}connect(){return j(this,void 0,void 0,function*(){this.connected||(this._injectElement(),yield new Promise((e,t)=>{this._connectHandler={resolve:e,reject:t}}))})}disconnect(){return j(this,void 0,void 0,function*(){yield this._sendIframeMessage({method:`disconnect`}),this._disconnected()})}signTransaction(e){return j(this,void 0,void 0,function*(){if(!this.connected||!this.publicKey)throw Error(`Wallet not connected`);try{let t=m(e),{transaction:n}=yield this._sendIframeMessage({method:`signTransactionV2`,params:{transaction:f.default.encode(t)}});return p(e)?o.from(f.default.decode(n)):s.deserialize(f.default.decode(n))}catch(e){throw Error((e?.toString)?.call(e)||`Failed to sign transaction`)}})}signAllTransactions(e){return j(this,void 0,void 0,function*(){if(!this.connected||!this.publicKey)throw Error(`Wallet not connected`);try{let t=e.map(e=>m(e)),{transactions:n}=yield this._sendIframeMessage({method:`signAllTransactionsV2`,params:{transactions:t.map(e=>f.default.encode(e))}});return n.map((t,n)=>p(e[n])?o.from(f.default.decode(t)):s.deserialize(f.default.decode(t)))}catch(e){throw Error((e?.toString)?.call(e)||`Failed to sign transactions`)}})}signAndSendTransaction(e,t){return j(this,void 0,void 0,function*(){if(!this.connected||!this.publicKey)throw Error(`Wallet not connected`);try{let n=m(e),{signature:r}=yield this._sendIframeMessage({method:`signAndSendTransaction`,params:{transaction:f.default.encode(n),options:t}});return r}catch(e){throw Error((e?.toString)?.call(e)||`Failed to sign and send transaction`)}})}signMessage(e,t=`utf8`){return j(this,void 0,void 0,function*(){if(!this.connected||!this.publicKey)throw Error(`Wallet not connected`);try{let{signature:n}=yield this._sendIframeMessage({method:`signMessage`,params:{data:f.default.encode(e),display:t}});return Uint8Array.from(f.default.decode(n))}catch(e){throw Error((e?.toString)?.call(e)||`Failed to sign message`)}})}sign(e,t=`utf8`){return j(this,void 0,void 0,function*(){return yield this.signMessage(e,t)})}static isSupported(){return j(this,void 0,void 0,function*(){return!!(yield _())})}standardSignAndSendTransaction(...e){return j(this,void 0,void 0,function*(){if(!this.connected)throw Error(`not connected`);let t=[];if(e.length===1){let{transaction:n,account:r,chain:i,options:a}=e[0],{minContextSlot:o,preflightCommitment:c,skipPreflight:l,maxRetries:u}=a||{};if(r!==this._account)throw Error(`invalid account`);if(!y(i))throw Error(`invalid chain`);let d=yield this.signAndSendTransaction(s.deserialize(n),{preflightCommitment:c,minContextSlot:o,maxRetries:u,skipPreflight:l});t.push({signature:f.default.decode(d)})}else if(e.length>1)for(let n of e)t.push(...yield this.standardSignAndSendTransaction(n));return t})}standardSignTransaction(...e){return j(this,void 0,void 0,function*(){if(!this.connected)throw Error(`not connected`);let t=[];if(e.length===1){let{transaction:n,account:r,chain:i}=e[0];if(r!==this._account)throw Error(`invalid account`);if(i&&!y(i))throw Error(`invalid chain`);let a=yield this.signTransaction(s.deserialize(n));t.push({signedTransaction:a.serialize()})}else if(e.length>1){let n;for(let t of e){if(t.account!==this._account)throw Error(`invalid account`);if(t.chain){if(!y(t.chain))throw Error(`invalid chain`);if(n){if(t.chain!==n)throw Error(`conflicting chain`)}else n=t.chain}}let r=e.map(({transaction:e})=>s.deserialize(e)),i=yield this.signAllTransactions(r);t.push(...i.map(e=>({signedTransaction:e.serialize()})))}return t})}standardSignMessage(...e){return j(this,void 0,void 0,function*(){if(!this.connected)throw Error(`not connected`);let t=[];if(e.length===1){let{message:n,account:r}=e[0];if(r!==this._account)throw Error(`invalid account`);let i=yield this.signMessage(n);t.push({signedMessage:n,signature:i})}else if(e.length>1)for(let n of e)t.push(...yield this.standardSignMessage(n));return t})}};M.IFRAME_URL=`https://widget.solflare.com/`;var N=M;export{A as StandardSolflareMetaMaskWalletAccount,N as default};