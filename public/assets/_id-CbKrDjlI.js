import{n as e,t}from"./PopupModal-RhRFMrUU.js";import{$n as n,An as r,Dt as i,Fn as a,Kn as o,O as s,On as c,Qn as l,Tt as u,Un as d,Vn as f,Xn as p,at as m,b as h,dt as g,ft as _,g as v,ir as y,j as b,k as x,lt as S,nr as C,ot as w,p as T,qn as E,sr as D,tr as O,tt as k,v as A,vt as j,x as M,y as N}from"./index-DqpiM8fm.js";var P=D(y(),1),F=D(o(),1),I=D(C(),1);const L=e=>{let t=(0,F.c)(18),{spins:n}=e,r,i,a,o;if(t[0]!==n){let e=n.filter(R),s=z;o=`border border-gray-1100 rounded-[20px] w-full overflow-x-auto xl:overflow-hidden`,i=`table xl:w-full w-[500px] md:w-[600px]`;let c;t[5]===Symbol.for(`react.memo_cache_sentinel`)?(c=(0,I.jsx)(`th`,{scope:`col`,className:`text-base w-1/3 text-start font-inter text-gray-1600 font-medium px-4 md:px-10 py-4 md:py-7`,children:`Prize`}),t[5]=c):c=t[5];let l;t[6]===Symbol.for(`react.memo_cache_sentinel`)?(l=(0,I.jsx)(`th`,{scope:`col`,className:`text-base w-1/5 text-start font-inter text-gray-1600 font-medium`,children:(0,I.jsx)(`div`,{className:`pl-5 h-6`,children:` TX`})}),t[6]=l):l=t[6],t[7]===Symbol.for(`react.memo_cache_sentinel`)?(a=(0,I.jsx)(`thead`,{className:`bg-black-1300 border-b border-gray-1200`,children:(0,I.jsxs)(`tr`,{className:`flex-1`,children:[c,l,(0,I.jsx)(`th`,{scope:`col`,className:`text-base w-1/5 text-start font-inter text-gray-1600 font-medium`,children:(0,I.jsx)(`div`,{className:`pl-5 h-6`,children:`Time`})})]})}),t[7]=a):a=t[7];let u;t[8]===Symbol.for(`react.memo_cache_sentinel`)?(u=(e,t)=>(0,I.jsxs)(`tr`,{className:`flex-1`,children:[(0,I.jsx)(`td`,{scope:`row`,children:(0,I.jsxs)(`div`,{className:`md:px-10 px-4 flex items-center gap-5 md:gap-2.5 py-6 border-b border-gray-1100`,children:[(0,I.jsx)(`img`,{src:e.prize?.image||`/images/prize-image.png`,className:`md:w-[60px] w-10 h-10 md:h-[60px] rounded-full object-cover`,alt:`no img`}),e.prize?e.prize.isNft?(0,I.jsx)(`p`,{className:`text-base text-white font-medium font-inter`,children:e.prize.name&&e.prize.name.length>10?e.prize.name.slice(0,10)+`...`:e.prize.name}):(0,I.jsx)(`p`,{className:`text-base text-white font-medium font-inter`,children:s(e.prize.prizeAmount,e.prize.mint)}):(0,I.jsx)(`p`,{className:`text-base text-white font-medium font-inter`,children:`Prize not claimed yet`})]})}),(0,I.jsx)(`td`,{children:(0,I.jsxs)(`div`,{className:`3xl:px-5 px-0 flex items-center gap-2.5 py-[34px] md:py-[42px] border-b border-gray-1100`,children:[(0,I.jsx)(`p`,{className:`md:text-base text-sm text-white font-medium font-inter`,children:e.transaction.transactionId.slice(0,4)+`...`+e.transaction.transactionId.slice(-6)}),(0,I.jsx)(`img`,{src:`/icons/external-link-icon.svg`,onClick:()=>window.open(`https://solscan.io/tx/${e.transaction.transactionId}`,`_blank`),className:`w-5 h-5 cursor-pointer`,alt:`link`})]})}),(0,I.jsx)(`td`,{children:(0,I.jsx)(`div`,{className:`3xl:px-5 px-0 flex items-center gap-2.5 py-[34px] md:py-[42px] border-b border-gray-1100`,children:(0,I.jsx)(`p`,{className:`md:text-base text-sm text-white font-medium font-inter`,children:new Date(e.spunAt).toLocaleString(`en-GB`,{day:`2-digit`,month:`short`,year:`2-digit`,hour:`2-digit`,minute:`2-digit`,hour12:!1}).replace(`,`,``).replace(/ (\d{2})$/,`'$1`)})})})]}),t[8]=u):u=t[8],r=e.map(u),t[0]=n,t[1]=r,t[2]=i,t[3]=a,t[4]=o}else r=t[1],i=t[2],a=t[3],o=t[4];let s;t[9]===r?s=t[10]:(s=(0,I.jsx)(`tbody`,{children:r}),t[9]=r,t[10]=s);let c;t[11]!==i||t[12]!==a||t[13]!==s?(c=(0,I.jsxs)(`table`,{className:i,children:[a,s]}),t[11]=i,t[12]=a,t[13]=s,t[14]=c):c=t[14];let l;return t[15]!==o||t[16]!==c?(l=(0,I.jsx)(`div`,{className:o,children:c}),t[15]=o,t[16]=c,t[17]=l):l=t[17],l};function R(e){return e.isPendingClaim===!1&&e.claimedAt!==null}function z(e,t){return`${parseFloat(e)/10**(S.find(e=>e.address===t)?.decimals||0)}`}d();const B=()=>{let e=l(),{checkAndInvalidateToken:t}=_(),{publicKey:n,sendTransaction:r}=a(),i=async e=>{try{if(!n)throw Error(`Wallet not connected`);if(!await t(n.toBase58()))throw Error(`Signature verification failed`);if(!e.gumballId)throw Error(`Gumball ID is required`);return!0}catch(e){return e instanceof Error?E.error(e.message):E.error(`Something went wrong`),!1}};return{spinGumballFunction:p({mutationKey:[`gumball`,`spin`],mutationFn:async e=>{if(!await i(e))throw Error(`Validation failed`);console.log(`args`,e);let{base64Transaction:t,minContextSlot:n,blockhash:a,lastValidBlockHeight:o}=await h(e.gumballId.toString()),s=Buffer.from(t,`base64`),c=await r(f.from(s),g,{minContextSlot:n}),l=await g.confirmTransaction({blockhash:a,lastValidBlockHeight:o,signature:c});if(l.value.err)throw console.log(`Failed to create auction`,l.value.err),Error(`Failed to create auction`);let u=await M(e.gumballId.toString(),c.toString());if(u.error)throw Error(u.error);return e.gumballId},onSuccess:t=>{e.invalidateQueries({queryKey:[`gumball`,t.toString()]}),E.success(`Gumball spun successfully`)},onError:e=>{e.message!==`Validation failed`&&E.error(`Failed to spin gumball`)}})}};d();const V=()=>{let e=l(),{checkAndInvalidateToken:t}=_(),{publicKey:n,sendTransaction:r}=a(),i=async e=>{try{if(!n)throw Error(`Wallet not connected`);if(!await t(n.toBase58()))throw Error(`Signature verification failed`);if(!e.gumballId)throw Error(`Gumball ID is required`);if(!e.spinId)throw Error(`Spin ID is required`);return!0}catch(e){return e instanceof Error?E.error(e.message):E.error(`Something went wrong`),!1}};return{claimGumballPrizeFunction:p({mutationKey:[`gumball`,`claim`],mutationFn:async e=>{if(!await i(e))throw Error(`Validation failed`);console.log(`args`,e);let{base64Transaction:t,minContextSlot:n,blockhash:a,lastValidBlockHeight:o,prizeIndex:s}=await N(e.gumballId.toString(),e.spinId.toString()),c=Buffer.from(t,`base64`),l=await r(f.from(c),g,{minContextSlot:n}),u=await g.confirmTransaction({blockhash:a,lastValidBlockHeight:o,signature:l});if(u.value.err)throw console.log(`Failed to create auction`,u.value.err),Error(`Failed to create auction`);let d=await A(e.gumballId.toString(),l.toString(),s,e.spinId);if(d.error)throw Error(d.error);return{gumballId:e.gumballId,prizeIndex:s}},onSuccess:t=>{e.invalidateQueries({queryKey:[`gumball`,t.gumballId.toString()]}),E.success(`Gumball prize claimed successfully`)},onError:e=>{e.message!==`Validation failed`&&E.error(`Failed to claim gumball prize`)}})}};var H=D(o(),1);const U=e=>{let t=(0,H.c)(48),{prizes:n,isActive:r,status:i,isSpinning:a,onSpinComplete:o}=e,s=a===void 0?!1:a,c=(0,P.useRef)(null),l=(0,P.useRef)(null),u;t[0]===Symbol.for(`react.memo_cache_sentinel`)?(u=[],t[0]=u):u=t[0];let d=(0,P.useRef)(u),f;t[1]===Symbol.for(`react.memo_cache_sentinel`)?(f=new Map,t[1]=f):f=t[1];let p=(0,P.useRef)(f),m=(0,P.useRef)(0),h;t[2]===Symbol.for(`react.memo_cache_sentinel`)?(h={width:0,height:0},t[2]=h):h=t[2];let[g,_]=(0,P.useState)(h),v=W,y;t[3]!==g.height||t[4]!==g.width||t[5]!==n?(y=()=>{if(!g.width||!g.height)return;let e=n.reduce(ee,0),t=[];n.forEach((n,r)=>{let i=Math.min(n.remainingQuantity,15),a=v(n.remainingQuantity,e,n.isNft);for(let e=0;e<i;e++){let i=a+10;t.push({id:`${r}-${e}`,x:i+Math.random()*(g.width-i*2),y:i+Math.random()*(g.height-i*2),vx:(Math.random()-.5)*3,vy:(Math.random()-.5)*3,radius:a,image:n.image||`/images/gumballs/sol-img-frame.png`,isNft:n.isNft,prizeIndex:r})}}),d.current=t},t[3]=g.height,t[4]=g.width,t[5]=n,t[6]=y):y=t[6];let b=y,x,S;t[7]===n?(x=t[8],S=t[9]):(x=()=>{new Set(n.map(te)).forEach(e=>{if(!p.current.has(e)){let t=new Image;t.crossOrigin=`anonymous`,t.src=e,p.current.set(e,t)}})},S=[n],t[7]=n,t[8]=x,t[9]=S),(0,P.useEffect)(x,S);let C,w;t[10]===Symbol.for(`react.memo_cache_sentinel`)?(C=()=>{let e=()=>{if(c.current){let e=c.current.getBoundingClientRect();_({width:e.width,height:e.height})}};return e(),window.addEventListener(`resize`,e),()=>window.removeEventListener(`resize`,e)},w=[],t[10]=C,t[11]=w):(C=t[10],w=t[11]),(0,P.useEffect)(C,w);let T;t[12]!==g.height||t[13]!==g.width||t[14]!==b?(T=()=>{g.width&&g.height&&b()},t[12]=g.height,t[13]=g.width,t[14]=b,t[15]=T):T=t[15];let E;t[16]!==g||t[17]!==b?(E=[g,b],t[16]=g,t[17]=b,t[18]=E):E=t[18],(0,P.useEffect)(T,E);let D=(0,P.useRef)(0),O=(0,P.useRef)(!1),k;t[19]===Symbol.for(`react.memo_cache_sentinel`)?(k=[],t[19]=k):k=t[19];let A=(0,P.useRef)(k),j,M;t[20]===s?(j=t[21],M=t[22]):(j=()=>{s&&(D.current=Date.now(),O.current=!1,A.current=d.current.map(G))},M=[s],t[20]=s,t[21]=j,t[22]=M),(0,P.useEffect)(j,M);let N;t[23]!==g.height||t[24]!==g.width||t[25]!==s||t[26]!==o?(N=()=>{if(!l.current||!g.width||!g.height)return;let e=l.current.getContext(`2d`);if(!e)return;let t=d.current.map(ne),n=Math.min(g.width,g.height)*.35,r=d.current.map((e,t)=>t/d.current.length*Math.PI*2),i=0,a=()=>{e.clearRect(0,0,g.width,g.height),i+=.015;let c=g.width/2,l=g.height/2;if(s&&!O.current&&Date.now()-D.current>=5e3&&(O.current=!0,o&&o()),d.current.forEach((a,o)=>{let u=t[o];if(s&&!O.current){let e=Date.now()-D.current,t=Math.min(e/5e3,1),s=(1-(t<.5?4*t*t*t:1-(-2*t+2)**3/2)*.7)*12,u=r[o]+i*s,d=n*(.8+.2*Math.sin(t*Math.PI));a.x=c+Math.cos(u)*d,a.y=l+Math.sin(u)*d}else{a.vx=Math.sin(i+u)*.5,a.vy=Math.cos(i*.7+u)*.4,a.x+=a.vx,a.y+=a.vy;let e=a.radius+5;a.x<e?a.x=e:a.x>g.width-e&&(a.x=g.width-e),a.y<e?a.y=e:a.y>g.height-e&&(a.y=g.height-e)}e.beginPath(),e.arc(a.x+3,a.y+3,a.radius,0,Math.PI*2),e.fillStyle=`rgba(0, 0, 0, 0.08)`,e.fill(),e.save(),e.beginPath(),e.arc(a.x,a.y,a.radius,0,Math.PI*2),e.closePath(),e.clip();let d=p.current.get(a.image);if(d&&d.complete&&d.naturalWidth>0)e.drawImage(d,a.x-a.radius,a.y-a.radius,a.radius*2,a.radius*2);else{let t=e.createRadialGradient(a.x-a.radius*.3,a.y-a.radius*.3,0,a.x,a.y,a.radius);t.addColorStop(0,a.isNft?`#ff69b4`:`#ffd700`),t.addColorStop(1,a.isNft?`#ff1493`:`#ff8c00`),e.fillStyle=t,e.fill()}e.restore(),e.beginPath(),e.arc(a.x,a.y,a.radius,0,Math.PI*2),s&&!O.current?(e.strokeStyle=`rgba(255, 20, 147, 0.8)`,e.lineWidth=3):(e.strokeStyle=a.isNft?`rgba(255, 20, 147, 0.6)`:`rgba(200, 200, 200, 0.8)`,e.lineWidth=a.isNft?3:2),e.stroke(),(a.isNft||s&&!O.current)&&(e.beginPath(),e.arc(a.x,a.y,a.radius+4,0,Math.PI*2),e.strokeStyle=s&&!O.current?`rgba(255, 20, 147, 0.4)`:`rgba(255, 20, 147, 0.2)`,e.lineWidth=4,e.stroke())}),!s||O.current)for(let e=0;e<d.current.length;e++)for(let t=e+1;t<d.current.length;t++){let n=d.current[e],r=d.current[t],i=r.x-n.x,a=r.y-n.y,o=Math.sqrt(i*i+a*a),s=n.radius+r.radius+5;if(o<s){let e=Math.atan2(a,i),t=s-o,c=t/2*Math.cos(e)*.3,l=t/2*Math.sin(e)*.3;n.x-=c,n.y-=l,r.x+=c,r.y+=l}}m.current=requestAnimationFrame(a)};return a(),()=>{m.current&&cancelAnimationFrame(m.current)}},t[23]=g.height,t[24]=g.width,t[25]=s,t[26]=o,t[27]=N):N=t[27];let F;t[28]!==g||t[29]!==s||t[30]!==o?(F=[g,s,o],t[28]=g,t[29]=s,t[30]=o,t[31]=F):F=t[31],(0,P.useEffect)(N,F);let L;t[32]===n?L=t[33]:(L=n.reduce(K,0),t[32]=n,t[33]=L);let R=L;if(!n||n.length===0){let e;return t[34]===Symbol.for(`react.memo_cache_sentinel`)?(e=(0,I.jsx)(`div`,{className:`w-full h-[300px] rounded-[20px] bg-transparent flex items-center justify-center`,children:(0,I.jsxs)(`div`,{className:`relative  w-full h-full bg-black/70 flex items-center justify-center z-10 rounded-[20px]`,children:[(0,I.jsx)(`img`,{src:`/images/ended-img-1.png`,alt:`no-prizes`,className:`w-full h-full object-cover absolute -z-10 rounded-[20px]`}),(0,I.jsx)(`div`,{className:`absolute inset-0 bg-black/70 flex items-center justify-center z-10 rounded-[20px]`}),(0,I.jsx)(`p`,{className:`md:text-[28px] text-lg text-white font-bold font-inter absolute z-10 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2`,children:`No Prizes Available`})]})}),t[34]=e):e=t[34],e}let z;t[35]!==g.height||t[36]!==g.width?(z=(0,I.jsx)(`canvas`,{ref:l,width:g.width,height:g.height,className:`absolute inset-0 `}),t[35]=g.height,t[36]=g.width,t[37]=z):z=t[37];let B;t[38]!==r||t[39]!==i?(B=!r&&(0,I.jsx)(`div`,{className:`absolute inset-0 bg-black/50 flex items-center justify-center z-10`,children:(0,I.jsx)(`p`,{className:`md:text-[28px] text-lg text-white font-bold font-inter`,children:i===`CANCELLED`?`Cancelled`:i===`COMPLETED_SUCCESSFULLY`||i===`COMPLETED_FAILED`?`Sale Ended`:`Not Started`})}),t[38]=r,t[39]=i,t[40]=B):B=t[40];let V=R===1?`prize`:`prizes`,U;t[41]!==V||t[42]!==R?(U=(0,I.jsx)(`div`,{className:`absolute top-4 right-4 bg-primary-color px-3 py-1.5 rounded-full z-20`,children:(0,I.jsxs)(`span`,{className:`text-gray-600 text-sm font-inter font-medium`,children:[R,` `,V]})}),t[41]=V,t[42]=R,t[43]=U):U=t[43];let q;return t[44]!==z||t[45]!==B||t[46]!==U?(q=(0,I.jsx)(`div`,{className:`relative w-full min-h-[300px]  rounded-[20px]`,children:(0,I.jsxs)(`div`,{ref:c,className:`relative w-full min-h-[300px] h-full rounded-[20px] overflow-hidden bg-transparent`,children:[z,B,U]})}),t[44]=z,t[45]=B,t[46]=U,t[47]=q):q=t[47],q};function W(e,t,n){let r=n?30:0,i=20+e/Math.max(t,1)*(10-r)+r;return Math.max(20,Math.min(i,30))}function ee(e,t){return e+t.remainingQuantity}function te(e){return e.image||`/images/gumballs/sol-img-frame.png`}function G(e){return{x:e.x,y:e.y}}function ne(){return Math.random()*Math.PI*2}function K(e,t){return e+Math.min(t.quantity,15)}var q=D(o(),1);function re(e){let n=(0,q.c)(15),{isOpen:r,shouldEnableAutoClose:a,onClaimPrize:o,isClaiming:s}=e,c=a===void 0?!0:a,l;n[0]===Symbol.for(`react.memo_cache_sentinel`)?(l=(0,I.jsxs)(`div`,{className:`w-full flex flex-col items-center justify-center `,children:[(0,I.jsx)(`img`,{src:`/images/gumballs/gift_image_new.png`,alt:`spin popup`,className:`w-[150px] h-[150px]  transition duration-300 object-contain`}),(0,I.jsx)(`h1`,{className:`md:text-2xl text-xl text-center font-bold text-primary-color mb-2`,children:`You Won A Prize!`}),(0,I.jsx)(`p`,{className:`text-xs text-white font-medium font-inter`,children:`Click claim to reveal your prize`})]}),n[0]=l):l=n[0];let u,d;n[1]===Symbol.for(`react.memo_cache_sentinel`)?(u=(0,I.jsx)(`rect`,{width:`347`,height:`2`,fill:`url(#paint0_linear_665_538)`}),d=(0,I.jsx)(`rect`,{width:`347`,height:`2`,fill:`url(#paint1_linear_665_538)`}),n[1]=u,n[2]=d):(u=n[1],d=n[2]);let f;n[3]===Symbol.for(`react.memo_cache_sentinel`)?(f=(0,I.jsxs)(`linearGradient`,{id:`paint0_linear_665_538`,x1:`0`,y1:`1`,x2:`347`,y2:`1`,gradientUnits:`userSpaceOnUse`,children:[(0,I.jsx)(`stop`,{"stop-color":`#212121`}),(0,I.jsx)(`stop`,{offset:`0.524038`,"stop-color":`#FFD400`}),(0,I.jsx)(`stop`,{offset:`0.9375`,"stop-color":`#212121`})]}),n[3]=f):f=n[3];let p;n[4]===Symbol.for(`react.memo_cache_sentinel`)?(p=(0,I.jsxs)(`svg`,{width:`347`,height:`2`,viewBox:`0 0 347 2`,fill:`none`,xmlns:`http://www.w3.org/2000/svg`,children:[u,d,(0,I.jsxs)(`defs`,{children:[f,(0,I.jsxs)(`linearGradient`,{id:`paint1_linear_665_538`,x1:`0`,y1:`1`,x2:`347`,y2:`1`,gradientUnits:`userSpaceOnUse`,children:[(0,I.jsx)(`stop`,{"stop-color":`#212121`}),(0,I.jsx)(`stop`,{offset:`0.524038`,"stop-color":`#FDED9C`,"stop-opacity":`0.77`}),(0,I.jsx)(`stop`,{offset:`0.9375`,"stop-color":`#212121`})]})]})]}),n[4]=p):p=n[4];let m;n[5]===s?m=n[6]:(m=s?(0,I.jsx)(i,{className:`w-5 h-5 text-black-1000 animate-spin`}):`Claim Prize`,n[5]=s,n[6]=m);let h;n[7]!==s||n[8]!==o||n[9]!==m?(h=(0,I.jsxs)(`div`,{className:`flex h-full flex-col  items-center justify-start gap-4`,children:[l,(0,I.jsxs)(`div`,{className:`w-full flex flex-col items-center justify-center gap-4 py-1 `,children:[p,(0,I.jsx)(k,{text:m,className:`w-[80%] disabled:opacity-50 disabled:cursor-not-allowed`,onclick:o,disabled:s})]})]}),n[7]=s,n[8]=o,n[9]=m,n[10]=h):h=n[10];let g;return n[11]!==r||n[12]!==c||n[13]!==h?(g=(0,I.jsx)(t,{isOpen:r,showCloseButton:!1,shouldEnableAutoClose:c,children:h}),n[11]=r,n[12]=c,n[13]=h,n[14]=g):g=n[14],g}var ie=D(o(),1);function ae(e){let n=(0,ie.c)(18),{isOpen:r,shouldEnableAutoClose:i,onClose:a,prize:o}=e,s=i===void 0?!0:i,c=oe,l;n[0]===Symbol.for(`react.memo_cache_sentinel`)?(l=(0,I.jsx)(`h1`,{className:`md:text-2xl text-xl text-center font-bold text-primary-color mb-2`,children:`Congratulations! ðŸŽ‰ `}),n[0]=l):l=n[0];let u,d;n[1]===Symbol.for(`react.memo_cache_sentinel`)?(u=(0,I.jsx)(`rect`,{width:`347`,height:`2`,fill:`url(#paint0_linear_665_538)`}),d=(0,I.jsx)(`rect`,{width:`347`,height:`2`,fill:`url(#paint1_linear_665_538)`}),n[1]=u,n[2]=d):(u=n[1],d=n[2]);let f;n[3]===Symbol.for(`react.memo_cache_sentinel`)?(f=(0,I.jsxs)(`linearGradient`,{id:`paint0_linear_665_538`,x1:`0`,y1:`1`,x2:`347`,y2:`1`,gradientUnits:`userSpaceOnUse`,children:[(0,I.jsx)(`stop`,{"stop-color":`#212121`}),(0,I.jsx)(`stop`,{offset:`0.524038`,"stop-color":`#FFD400`}),(0,I.jsx)(`stop`,{offset:`0.9375`,"stop-color":`#212121`})]}),n[3]=f):f=n[3];let p;n[4]===Symbol.for(`react.memo_cache_sentinel`)?(p=(0,I.jsxs)(`div`,{className:`w-full flex flex-col items-center justify-center gap-4`,children:[l,(0,I.jsxs)(`svg`,{width:`347`,height:`2`,viewBox:`0 0 347 2`,fill:`none`,xmlns:`http://www.w3.org/2000/svg`,children:[u,d,(0,I.jsxs)(`defs`,{children:[f,(0,I.jsxs)(`linearGradient`,{id:`paint1_linear_665_538`,x1:`0`,y1:`1`,x2:`347`,y2:`1`,gradientUnits:`userSpaceOnUse`,children:[(0,I.jsx)(`stop`,{"stop-color":`#212121`}),(0,I.jsx)(`stop`,{offset:`0.524038`,"stop-color":`#FDED9C`,"stop-opacity":`0.77`}),(0,I.jsx)(`stop`,{offset:`0.9375`,"stop-color":`#212121`})]})]})]})]}),n[4]=p):p=n[4];let m;n[5]===o?m=n[6]:(m=o&&(0,I.jsxs)(`div`,{className:`flex flex-col w-full gap-2 items-center justify-center`,children:[(0,I.jsx)(`img`,{src:o?.prizeImage??`/images/gumballs/gift_image_new.png`,alt:`prize image`,className:`w-[150px] h-[150px]  transition duration-300 object-contain`}),o?.isNft?(0,I.jsx)(`h1`,{className:`md:text-2xl text-xl -mt:4 text-center font-bold text-primary-color mb-2`,children:`1x NFT`}):(0,I.jsxs)(`h1`,{className:`md:text-2xl text-xl -mt-4 text-center font-bold text-primary-color mb-2`,children:[c(o?.prizeAmount,o?.prizeMint),` `,S.find(e=>e.address===o?.prizeMint)?.symbol]}),(0,I.jsx)(`p`,{className:`text-sm text-white font-medium font-inter`,children:`Added to Your Wallet`})]}),n[5]=o,n[6]=m);let h,g;n[7]===Symbol.for(`react.memo_cache_sentinel`)?(h=(0,I.jsx)(`rect`,{width:`347`,height:`2`,fill:`url(#paint0_linear_665_538)`}),g=(0,I.jsx)(`rect`,{width:`347`,height:`2`,fill:`url(#paint1_linear_665_538)`}),n[7]=h,n[8]=g):(h=n[7],g=n[8]);let _;n[9]===Symbol.for(`react.memo_cache_sentinel`)?(_=(0,I.jsxs)(`linearGradient`,{id:`paint0_linear_665_538`,x1:`0`,y1:`1`,x2:`347`,y2:`1`,gradientUnits:`userSpaceOnUse`,children:[(0,I.jsx)(`stop`,{"stop-color":`#212121`}),(0,I.jsx)(`stop`,{offset:`0.524038`,"stop-color":`#FFD400`}),(0,I.jsx)(`stop`,{offset:`0.9375`,"stop-color":`#212121`})]}),n[9]=_):_=n[9];let v;n[10]===Symbol.for(`react.memo_cache_sentinel`)?(v=(0,I.jsx)(`div`,{className:`w-full flex flex-col items-center justify-center gap-4 py-1 `,children:(0,I.jsxs)(`svg`,{width:`347`,height:`2`,viewBox:`0 0 347 2`,fill:`none`,xmlns:`http://www.w3.org/2000/svg`,children:[h,g,(0,I.jsxs)(`defs`,{children:[_,(0,I.jsxs)(`linearGradient`,{id:`paint1_linear_665_538`,x1:`0`,y1:`1`,x2:`347`,y2:`1`,gradientUnits:`userSpaceOnUse`,children:[(0,I.jsx)(`stop`,{"stop-color":`#212121`}),(0,I.jsx)(`stop`,{offset:`0.524038`,"stop-color":`#FDED9C`,"stop-opacity":`0.77`}),(0,I.jsx)(`stop`,{offset:`0.9375`,"stop-color":`#212121`})]})]})]})}),n[10]=v):v=n[10];let y;n[11]===m?y=n[12]:(y=(0,I.jsxs)(`div`,{className:`flex h-full flex-col  items-center justify-start gap-2`,children:[p,m,v]}),n[11]=m,n[12]=y);let b;return n[13]!==r||n[14]!==a||n[15]!==s||n[16]!==y?(b=(0,I.jsx)(t,{isOpen:r,onClose:a,showCloseButton:!0,shouldEnableAutoClose:s,children:y}),n[13]=r,n[14]=a,n[15]=s,n[16]=y,n[17]=b):b=n[17],b}function oe(e,t){return`${parseFloat(e)/10**(S.find(e=>e.address===t)?.decimals||0)}`}function se(){let{id:t}=s.useParams(),{data:o,isLoading:l,isError:d,refetch:f}=v(t||``),p=o,h=O(),[g,_]=(0,P.useState)(null),[y,C]=(0,P.useState)(!1),[E,D]=(0,P.useState)(null),[A,M]=(0,P.useState)(null),{spinGumballFunction:N}=B(),{claimGumballPrizeFunction:F}=V(),{publicKey:R}=a(),{favouriteGumball:z}=w(R?.toString()||``),{getFavouriteGumball:H}=m(R?.toString()||``,`Gumballs`),{userVerifiedTokens:W,isLoading:ee,error:te}=x(),G=p?.isTicketSol?r:p?.ticketMint;W.find(e=>e.address===G)?.balance;let ne=(0,P.useMemo)(()=>H.data?.some(e=>e.id===Number(t)),[H.data,t]),[K,q]=(0,P.useState)([{name:`Gumball Prizes`,active:!0}]),ie=p?.status===`ACTIVE`,[oe,se]=(0,P.useState)(1),[ce,J]=(0,P.useState)(!1),[Y,X]=(0,P.useState)(!1),[le,Z]=(0,P.useState)(!1),Q=(0,P.useRef)(!1),$=(0,P.useMemo)(()=>{if(!p?.prizes)return[];let e={};return p.spins?.forEach(t=>{let n=t.prize?.prizeIndex;n!=null&&(e[n]=(e[n]||0)+1)}),p.prizes.map(t=>({...t,remainingQuantity:t.quantity-(e[t.prizeIndex]||0)})).filter(e=>e.remainingQuantity>0)},[p?.prizes,p?.spins]);console.log(`spins`,p?.spins);let ue=async()=>{try{await N.mutateAsync({gumballId:parseInt(t||``)}),X(!0)}catch(e){console.error(`Failed to spin gumball:`,e),X(!1),Z(!1)}},de=()=>{X(!1),Z(!0)},fe=async()=>{try{if(!A){console.error(`No unclaimed spin ID found`);return}D((await F.mutateAsync({gumballId:parseInt(t||``),spinId:A})).prizeIndex)}catch(e){console.error(`Failed to claim prize:`,e)}},{totalValueInSol:pe,isLoading:me,formattedValue:he}=T(p?.prizes),ge=(e,t)=>e?t?`${(parseFloat(e)/10**9).toFixed(7)} `:`${(parseFloat(e)/10**(S.find(e=>e.address===p?.ticketMint)?.decimals||0)).toFixed(7)}`:`0`,_e=p?p.ticketsSold/p.totalTickets*100:0,ve=e=>e?`${e.slice(0,4)}...${e.slice(-4)}`:``;(0,P.useEffect)(()=>{if(y&&p&&E!==null){let e=p.prizes.find(e=>e.prizeIndex===E);e&&_({gumballId:p.id,prizeIndex:e.prizeIndex,prizeMint:e.mint,ticketPrice:p.ticketPrice,ticketMint:p.ticketMint,isTicketSol:p.isTicketSol,prizeImage:e.image||``,prizeAmount:e.prizeAmount,isNft:e.isNft})}},[y,p,E]),(0,P.useEffect)(()=>{F.isSuccess&&F.data&&(C(!0),X(!1),f())},[F.isSuccess,F.data,f]);let ye=()=>!p||!R?null:(p.spins?.filter(e=>e.spinnerAddress===R.toString())||[]).sort((e,t)=>new Date(t.spunAt).getTime()-new Date(e.spunAt).getTime()).find(e=>e.isPendingClaim===!0||e.claimedAt===null)||null;return(0,P.useEffect)(()=>{Q.current=!1},[t]),(0,P.useEffect)(()=>{if(p&&R&&!Y&&!Q.current&&p.spins){let e=ye();e&&(J(!0),C(!1),_(null),M(e.id)),Q.current=!0}},[p,R,Y,t]),(0,P.useEffect)(()=>{if(le&&p&&R&&!Y){let e=ye();e&&(J(!0),C(!1),_(null),M(e.id)),Z(!1)}},[le,p,R,Y]),l?(0,I.jsx)(`main`,{className:`w-full min-h-[calc(100vh-300px)] flex items-center justify-center bg-black-1400`,children:(0,I.jsx)(`div`,{className:`text-center`,children:(0,I.jsx)(i,{className:`w-12 h-12 animate-spin text-primary-color mx-auto`})})}):d||!p?(0,I.jsx)(`main`,{className:`w-full min-h-[calc(100vh-300px)] flex items-center justify-center bg-black-1400`,children:(0,I.jsxs)(`div`,{className:`text-center flex-col gap-2`,children:[(0,I.jsx)(`p`,{className:`text-2xl text-red-500 font-inter font-semibold`,children:`Gumball not found`}),(0,I.jsxs)(n,{to:`/gumballs`,className:`px-6 cursor-pointer transition duration-300 hover:opacity-80 inline-flex items-center gap-2 py-2.5 bg-gray-1000 rounded-full text-base font-semibold text-white`,children:[(0,I.jsx)(`img`,{src:`/icons/back-arw.svg`,className:`invert`,alt:``}),`Back`]})]})}):(0,I.jsxs)(`main`,{className:`bg-black-1400`,children:[(0,I.jsx)(`div`,{className:`w-full pb-2 md:pb-16 md:pt-44 pt-36 max-w-[1440px] px-5 mx-auto`,children:(0,I.jsxs)(n,{to:`/gumballs`,className:`px-6 cursor-pointer transition duration-300 hover:opacity-80 inline-flex items-center gap-2 py-2.5 bg-gray-1000 rounded-full text-base font-semibold text-white`,children:[(0,I.jsx)(`img`,{src:`/icons/back-arw.svg`,className:`invert`,alt:``}),`Back`]})}),(0,I.jsx)(ae,{isOpen:y,shouldEnableAutoClose:!0,onClose:()=>{J(!1),X(!1),C(!1),_(null),D(null),Z(!1),M(null)},prize:g}),(0,I.jsx)(re,{isOpen:ce&&!y,shouldEnableAutoClose:!1,onClaimPrize:fe,isClaiming:F.isPending}),(0,I.jsx)(u.section,{initial:{opacity:0,y:100},animate:{opacity:1,y:0},exit:{opacity:0,y:-100},transition:{duration:.3},className:`w-full pb-20 pt-10 md:pt-0`,children:(0,I.jsxs)(`div`,{className:`w-full max-w-[1440px] px-5 mx-auto`,children:[(0,I.jsxs)(`div`,{className:`w-full flex gap-[20px] md:gap-8 md:flex-row flex-col`,children:[(0,I.jsx)(`div`,{className:`flex-1`,children:(0,I.jsx)(`div`,{className:`md:p-[18px] h-full p-3 bg-black-1300 rounded-[20px]`,children:(0,I.jsx)(U,{prizes:$,isActive:ie,status:p.status,isSpinning:Y,onSpinComplete:de})})}),(0,I.jsx)(`div`,{className:`flex-1 max-w-[467px] bg-black-1300 p-6 rounded-[20px]`,children:(0,I.jsxs)(`div`,{className:`w-full`,children:[(0,I.jsxs)(`div`,{className:`w-full flex items-start md:items-center justify-between`,children:[(0,I.jsx)(`h1`,{className:`md:text-[28px] text-xl font-inter font-bold text-white`,children:p.name?.slice(0,20)+(p.name?.length>20?`...`:``)}),(0,I.jsx)(`span`,{className:`text-sm font-semibold px-3 py-1 rounded-full ${p.status===`ACTIVE`?`bg-green-500 text-white`:p.status===`COMPLETED_SUCCESSFULLY`||p.status===`COMPLETED_FAILED`||p.status===`CANCELLED`?`bg-red-600 text-white`:`bg-yellow-600 text-white`}`,children:p.status===`ACTIVE`?`Active`:p.status===`COMPLETED_SUCCESSFULLY`||p.status===`COMPLETED_FAILED`?`Ended`:p.status===`CANCELLED`?`Cancelled`:`Not Started`})]}),(0,I.jsxs)(`div`,{className:`w-full`,children:[(0,I.jsx)(`div`,{className:`w-full flex items-center justify-between md:pt-5 py-6 md:pb-6`,children:(0,I.jsxs)(`div`,{className:`flex w-full flex-row items-center justify-between`,children:[(0,I.jsxs)(`div`,{className:`inline-flex flex-col gap-2`,children:[(0,I.jsx)(`p`,{className:`text-base font-inter font-normal text-white`,children:`Creator`}),(0,I.jsxs)(`div`,{className:`inline-flex items-center gap-2`,children:[(0,I.jsx)(`img`,{src:p.creator.profileImage?c+p.creator.profileImage:j,className:`w-10 h-10 rounded-full object-cover`,alt:`no`}),(0,I.jsx)(`h4`,{className:`md:text-lg text-sm text-white font-inter font-semibold`,children:ve(p.creator.walletAddress)})]})]}),(0,I.jsx)(`button`,{onClick:()=>{z.mutate({gumballId:Number(t)||0})},className:`border hover:bg-primary-color hover:border-primary-color transition duration-300 cursor-pointer px-3 py-3 gap-2.5 border-black-1000 rounded-full text-sm md:text-base font-semibold font-inter text-black-1000 inline-flex items-center justify-center ${ne?`bg-primary-color border-primary-color text-black-1000 transition duration-300 `:` text-white border-white`}`,children:(0,I.jsx)(`svg`,{xmlns:`http://www.w3.org/2000/svg`,width:24,height:24,viewBox:`0 0 24 24`,fill:`currentColor`,children:(0,I.jsx)(`path`,{d:`M12 5.50066L11.4596 6.02076C11.601 6.16766 11.7961 6.25066 12 6.25066C12.2039 6.25066 12.399 6.16766 12.5404 6.02076L12 5.50066ZM9.42605 18.3219C7.91039 17.1271 6.25307 15.9603 4.93829 14.4798C3.64922 13.0282 2.75 11.3345 2.75 9.13713H1.25C1.25 11.8026 2.3605 13.8361 3.81672 15.4758C5.24723 17.0866 7.07077 18.3752 8.49742 19.4999L9.42605 18.3219ZM2.75 9.13713C2.75 6.98626 3.96537 5.18255 5.62436 4.42422C7.23607 3.68751 9.40166 3.88261 11.4596 6.02076L12.5404 4.98056C10.0985 2.44355 7.26409 2.02542 5.00076 3.05999C2.78471 4.07295 1.25 6.42506 1.25 9.13713H2.75ZM8.49742 19.4999C9.00965 19.9037 9.55954 20.3343 10.1168 20.6599C10.6739 20.9854 11.3096 21.25 12 21.25V19.75C11.6904 19.75 11.3261 19.6293 10.8736 19.3648C10.4213 19.1005 9.95208 18.7366 9.42605 18.3219L8.49742 19.4999ZM15.5026 19.4999C16.9292 18.3752 18.7528 17.0866 20.1833 15.4758C21.6395 13.8361 22.75 11.8026 22.75 9.13713H21.25C21.25 11.3345 20.3508 13.0282 19.0617 14.4798C17.7469 15.9603 16.0896 17.1271 14.574 18.3219L15.5026 19.4999ZM22.75 9.13713C22.75 6.42506 21.2153 4.07295 18.9992 3.05999C16.7359 2.02542 13.9015 2.44355 11.4596 4.98056L12.5404 6.02076C14.5983 3.88261 16.7639 3.68751 18.3756 4.42422C20.0346 5.18255 21.25 6.98626 21.25 9.13713H22.75ZM14.574 18.3219C14.0479 18.7366 13.5787 19.1005 13.1264 19.3648C12.6739 19.6293 12.3096 19.75 12 19.75V21.25C12.6904 21.25 13.3261 20.9854 13.8832 20.6599C14.4405 20.3343 14.9903 19.9037 15.5026 19.4999L14.574 18.3219Z`,fill:`currentColor`})})})]})}),p.status===`ACTIVE`&&(0,I.jsxs)(`div`,{className:`w-full flex flex-col gap-4 md:flex-row items-center justify-start px-5 py-3 bg-primary-color/10 rounded-[20px] mb-4`,children:[(0,I.jsx)(`p`,{className:`text-sm font-medium font-inter text-gray-1200 w-full`,children:`Ends in`}),(0,I.jsx)(e,{targetDate:new Date(p.endTime)})]}),(0,I.jsx)(`div`,{className:`w-full flex items-center justify-between py-4 px-5 rounded-[20px] bg-primary-color/10`,children:(0,I.jsxs)(`div`,{className:`inline-flex flex-col gap-2.5`,children:[(0,I.jsx)(`p`,{className:`font-inter text-sm text-gray-1200`,children:`Ticket Price `}),(0,I.jsxs)(`h3`,{className:`lg:text-[24px] text-lg font-semibold font-inter text-primary-color`,children:[parseFloat(ge(p.ticketPrice,p.isTicketSol)),p.isTicketSol?` SOL`:S.find(e=>e.address===p.ticketMint)?.symbol]})]})}),(0,I.jsxs)(`div`,{className:`w-full`,children:[p.status===`ACTIVE`&&R?.toBase58()!==p.creatorAddress?(0,I.jsxs)(`div`,{className:`w-full mt-5`,children:[(0,I.jsx)(`div`,{className:`w-full flex`,children:(0,I.jsx)(k,{onclick:ue,text:N.isPending?(0,I.jsx)(i,{className:`w-5 h-5 animate-spin text-black-1000`}):Y?`Spinning...`:$.length===0?`No Prizes Available`:R?p.ticketsSold===p.totalTickets?`Sold Out`:`Press To Spin`:`Connect Wallet`,className:`w-full h-12 flex items-center justify-center`,disabled:N.isPending||Y||$.length===0||!R||p.ticketsSold===p.totalTickets})}),(0,I.jsx)(`p`,{className:`md:text-base text-sm text-white font-medium font-inter pt-[18px] pb-10`,children:`Your balance: `})]}):p.creatorAddress===R?.toString()?(0,I.jsx)(`div`,{className:`w-full bg-primary-color/10 rounded-xl flex items-center justify-center h-12 my-10`,children:(0,I.jsx)(`button`,{onClick:()=>h.navigate({to:`/gumballs/create_gumballs/$id`,params:{id:t}}),className:`text-base cursor-pointer transition duration-300 hover:scale-105 text-primary-color/60 text-center font-semibold font-inter`,children:`Manage Gumball`})}):(0,I.jsx)(`div`,{className:`w-full bg-red-500/60 rounded-full flex items-center justify-center h-12 my-10`,children:(0,I.jsx)(`p`,{className:`text-base text-white text-center font-semibold font-inter`,children:p.status===`CANCELLED`?`Cancelled`:p.status===`COMPLETED_SUCCESSFULLY`||p.status===`COMPLETED_FAILED`?`Ended`:`Not Started Yet`})}),(0,I.jsxs)(`div`,{className:`w-full flex items-center gap-4`,children:[(0,I.jsx)(`div`,{className:`flex-1`,children:(0,I.jsx)(`div`,{className:`w-full bg-gray-1000 rounded-full h-4 relative`,children:(0,I.jsx)(`div`,{className:`bg-primary-color rounded-full absolute left-0 top-0 h-4 transition-all duration-300`,style:{width:`${Math.min(_e,100)}%`}})})}),(0,I.jsx)(`div`,{className:``,children:(0,I.jsxs)(`p`,{className:`md:text-base text-sm text-white font-medium font-inter`,children:[p.ticketsSold,` / `,p.totalTickets,` sold`]})})]})]})]})]})})]}),(0,I.jsxs)(`div`,{className:`w-full`,children:[(0,I.jsx)(`ul`,{className:`inline-flex items-center bg-white/15 gap-3 2xl:gap-4 mb-6 mt-14 p-1 rounded-full sm:w-auto`,children:K.map((e,t)=>(0,I.jsx)(`li`,{children:(0,I.jsx)(`button`,{onClick:()=>{q(K.map((e,n)=>({...e,active:n===t})))},className:`md:text-base whitespace-nowrap text-sm cursor-pointer font-inter font-medium transition duration-300 hover:bg-primary-color hover:text-black-1000 text-white rounded-full py-2.5 md:py-3 px-4 ${e.active?`bg-primary-color !text-black-1000`:`text-black-1000`}`,children:e.name})},t))}),K[0].active&&(0,I.jsxs)(`div`,{className:`md:grid md:grid-cols-2 items-start gap-5`,children:[(0,I.jsx)(b,{prizes:$}),(0,I.jsxs)(`div`,{className:`flex-1 md:-mt-[60px] mt-10`,children:[(0,I.jsx)(`span`,{className:`w-fit text-base font-medium text-center mb-6 text-black  px-5 md:-mt-4 py-3 rounded-full bg-primary-color flex items-center justify-center`,children:`Recent Spins`}),(0,I.jsx)(L,{spins:p.spins})]})]})]})]})})]})}export{se as component};