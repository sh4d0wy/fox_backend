import{Fn as e,On as t,Qn as n,Tt as r,er as i,ir as a,nr as o,qn as s,sr as c,vt as l,wn as u,yt as d}from"./index-DqpiM8fm.js";import{t as f}from"./useMyProfile-BdOJTPDo.js";var p=c(a()),m=c(o());function h(){let[a,o]=(0,p.useState)(null),[c,h]=(0,p.useState)(null),[g,_]=(0,p.useState)(!1),v=(0,p.useRef)(null),y=(0,p.useRef)(0),b=i(),{profilePicture:x,setProfilePicture:S,isUploadingProfilePicture:C,setIsUploadingProfilePicture:w,setProfilePictureError:T,updateProfilePictureVersion:E}=d(),{publicKey:D}=e(),{data:O}=f(!!D&&!!localStorage.getItem(`authToken`)),k=n(),A=(0,p.useMemo)(()=>x||l,[x]),j=e=>{let t=e.target.files?.[0];t&&M(t)},M=e=>{if(!e.type.startsWith(`image/`)){s.error(`Please upload an image file`);return}if(e.size>300*1024){s.error(`Image size should be less than 300kb`);return}h(e);let t=new FileReader;t.onloadend=()=>{o(t.result)},t.readAsDataURL(e)},N=e=>{e.preventDefault()},P=e=>{e.preventDefault(),y.current++,y.current===1&&_(!0)},F=e=>{e.preventDefault(),y.current--,y.current===0&&_(!1)},I=e=>{e.preventDefault(),y.current=0,_(!1);let t=e.dataTransfer.files?.[0];t&&M(t)},L=()=>{v.current?.click()},R=async(e,n)=>{try{w(!0),T(null);let n=await u(e);if(console.log(n),n.user.profileImage){console.log(`inside if`);let e=`${t}${n.user.profileImage}?t=${Date.now()}`;console.log(e),S(e),E(),k.invalidateQueries({queryKey:[`my-profile`]}),k.invalidateQueries({queryKey:[`profile-raffle-created`,D?.toBase58()]}),k.invalidateQueries({queryKey:[`profile-raffle-purchased`,D?.toBase58()]}),k.invalidateQueries({queryKey:[`profile-raffle-favourite`,D?.toBase58()]}),k.invalidateQueries({queryKey:[`profile-gumball-created`,D?.toBase58()]}),k.invalidateQueries({queryKey:[`profile-gumball-purchased`,D?.toBase58()]}),k.invalidateQueries({queryKey:[`profile-gumball-favourite`,D?.toBase58()]}),k.invalidateQueries({queryKey:[`profile-auction-created`,D?.toBase58()]}),k.invalidateQueries({queryKey:[`profile-auction-purchased`,D?.toBase58()]}),k.invalidateQueries({queryKey:[`profile-auction-favourite`,D?.toBase58()]}),k.invalidateQueries({queryKey:[`favourite-raffle`,D?.toBase58()]}),k.invalidateQueries({queryKey:[`favourite-gumball`,D?.toBase58()]}),k.invalidateQueries({queryKey:[`favourite-auction`,D?.toBase58()]}),k.invalidateQueries({queryKey:[`profile-raffle-stats`,D?.toBase58()]}),k.invalidateQueries({queryKey:[`profile-gumball-stats`,D?.toBase58()]}),k.invalidateQueries({queryKey:[`profile-auction-stats`,D?.toBase58()]})}s.success(`Profile picture updated successfully!`)}catch(e){console.error(`Failed to update profile picture:`,e),T(`Failed to update profile picture`),s.error(`Failed to update profile picture. Please try again.`)}finally{w(!1)}};return(0,p.useEffect)(()=>{O?.user?.profileImage?S(`${t}${O.user.profileImage}?t=${Date.now()}`):O?.user&&S(l)},[O,S]),(0,m.jsx)(`main`,{className:`bg-black-1100`,children:(0,m.jsx)(r.section,{initial:{opacity:0,y:100},animate:{opacity:1,y:0},exit:{opacity:0,y:-100},transition:{duration:.3},onDragOver:C?void 0:N,onDragEnter:C?void 0:P,onDragLeave:C?void 0:F,onDrop:C?void 0:I,className:`w-full min-h-screen md:pt-48 pt-36 pb-16 px-4`,children:(0,m.jsxs)(`div`,{className:`w-full max-w-[1000px] mx-auto `,children:[(0,m.jsxs)(`div`,{className:`w-full mb-10`,children:[(0,m.jsx)(`h1`,{className:`md:text-[40px] text-3xl text-center font-semibold text-white mb-3`,children:`Change Profile Picture`}),(0,m.jsx)(`p`,{className:`md:text-xl text-base font-inter text-center text-cream-1000`,children:`Upload a new profile picture`})]}),(0,m.jsxs)(`div`,{className:`w-full flex flex-col md:flex-row md:gap-[100px] gap-10 md:p-8 px-4 py-8 rounded-[12px] bg-primary-color/10`,children:[(0,m.jsxs)(`div`,{className:`md:w-1/3 w-full text-center flex flex-col items-center`,children:[(0,m.jsx)(`h3`,{className:`text-2xl font-inter font-semibold text-white mb-6`,children:a?`New Image Preview`:`Current Picture`}),(0,m.jsx)(`div`,{className:`w-[175px] h-[175px] relative`,children:(0,m.jsx)(`div`,{className:`w-full h-full rounded-full border-2 border-primary-color bg-gray-1200 flex items-center justify-center`,children:(0,m.jsx)(`img`,{src:a||A,className:`object-cover w-full h-full rounded-full`})})})]}),(0,m.jsxs)(`form`,{onSubmit:async e=>{e.preventDefault(),c&&a&&(await R(c,a),b({to:`/profile`}))},className:`md:w-2/3 flex flex-col gap-6`,children:[(0,m.jsx)(`div`,{className:`w-full flex flex-col gap-2 hover:bg-primary-color/10 transition duration-300 rounded-[12px] p-4`,children:(0,m.jsxs)(`label`,{className:`text-white gap-3 px-4 py-10 cursor-pointer border-2 border-dashed border-gray-1000 font-medium text-lg md:h-[217px] bg-black-1400 rounded-[12px] flex items-center justify-center flex-col`,htmlFor:`profilePicture`,children:[(0,m.jsx)(`input`,{ref:v,onChange:j,type:`file`,id:`profilePicture`,accept:`image/*`,hidden:!0,disabled:C,className:`w-full p-3 object-cover bg-black-1000 border border-gray-800 text-white`}),(0,m.jsx)(`h4`,{className:`text-center text-white font-inter font-medium`,children:g?`Drop the image here`:`Drag & drop your image here`}),(0,m.jsx)(`h4`,{className:`text-center text-white md:text-base text-sm font-inter font-medium`,children:`or`}),(0,m.jsx)(`div`,{className:`bg-primary-color md:text-base text-sm rounded-full py-1.5 px-10 text-black-1000 ${C?`opacity-50 cursor-not-allowed`:``}`,onClick:e=>{e.stopPropagation(),e.preventDefault(),L()},children:`Browse Files`}),(0,m.jsx)(`p`,{className:`text-center text-gray-1000 font-medium text-sm`,children:`PNG, JPG Max 300kb Square images recommended`})]})}),(0,m.jsxs)(`div`,{className:`grid  grid-cols-2 gap-5 place-items-center w-full`,children:[(0,m.jsx)(`button`,{type:`button`,disabled:C,className:`w-full disabled:opacity-50 disabled:cursor-not-allowed hover:scale-105  cursor-pointer py-3 border border-gray-1200 text-gray-1200 font-semibold rounded-full hover:opacity-90 transition duration-300`,onClick:()=>b({to:`/profile`}),children:`Cancel`}),(0,m.jsx)(`button`,{type:`submit`,disabled:C||!c||!a,className:`w-full disabled:opacity-50 disabled:cursor-not-allowed hover:scale-105 border border-transparent cursor-pointer py-3 bg-primary-color text-black-1000 font-semibold rounded-full hover:opacity-90 transition duration-300`,children:C?`Saving...`:`Save`})]})]})]})]})})})}export{h as component};